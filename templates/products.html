{% extends 'base.html' %}
{% block title %}Products List{% endblock %}
{% block content %}
<div class="card p-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="text-primary"><i class="bi bi-boxes"></i> Product List</h2>
    <a href="/add" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Add New</a>
  </div>

  <table class="table table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th><i class="bi bi-tag"></i> Name</th>
        <th><i class="bi bi-cash"></i> Price (PKR)</th>
        <th><i class="bi bi-basket"></i> Quantity</th>
        <th><i class="bi bi-calculator"></i> Total</th>
        <th><i class="bi bi-gear"></i> Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for product in products %}
      <tr>
        <td>{{ product.name }}</td>
        <td>{{ product.price }}</td>
        <td>{{ product.quantity }}</td>
        <td class="fw-bold text-success">{{ product.price * product.quantity }}</td>
        <td>
          <a href="/edit/{{ product._id }}" class="btn btn-warning btn-sm">
            <i class="bi bi-pencil"></i> Edit
          </a>
          <button class="btn btn-danger btn-sm" data-bs-toggle="modal"
                  data-bs-target="#deleteModal" data-id="{{ product._id }}"
                  data-name="{{ product.name }}">
            <i class="bi bi-trash"></i> Delete
          </button>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="5" class="text-center text-muted py-4">No products found ðŸ’¤</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ðŸ§¾ Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteModalLabel"><i class="bi bi-exclamation-triangle"></i> Confirm Delete</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete <strong id="productName"></strong>?</p>
        <p class="text-muted mb-0">This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <a id="confirmDeleteBtn" href="#" class="btn btn-danger">
          <i class="bi bi-trash"></i> Delete
        </a>
      </div>
    </div>
  </div>
</div>

<script>
  const deleteModal = document.getElementById('deleteModal')
  deleteModal.addEventListener('show.bs.modal', event => {
    const button = event.relatedTarget
    const productId = button.getAttribute('data-id')
    const productName = button.getAttribute('data-name')

    const nameElement = deleteModal.querySelector('#productName')
    const confirmBtn = deleteModal.querySelector('#confirmDeleteBtn')

    nameElement.textContent = productName
    confirmBtn.href = `/delete/${productId}`
  })
</script>
{% endblock %}
